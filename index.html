<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Meta Quest MR Model Viewer</title>
    <meta name="description" content="3D Model Viewer for Meta Quest in Mixed Reality">
     <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
     <!-- A-Frame Extras for gesture controls (scale/rotate) and teleport -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #overlay {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: sans-serif;
            font-size: 14px;
            z-index: 1000; /* Ensure it's above the A-Frame canvas */
            display: none; /* Hidden by default, shown on VR/AR entry */
        }
        #overlay p { margin: 5px 0; }
         #overlay ul { padding-left: 20px; margin: 5px 0;}
    </style>
</head>
<body>
     <div id="overlay">
        <p><strong>Controls:</strong></p>
        <p><strong>Right Controller:</strong></p>
        <ul>
            <li><strong>Trigger:</strong> Aim and release to teleport.</li>
        </ul>
        <p><strong>Left Controller (pointing at model):</strong></p>
        <ul>
             <li><strong>Grip + Move:</strong> Rotate model.</li>
             <li><strong>Trigger + Move Up/Down:</strong> Scale model.</li>
        </ul>
        <p>Enter VR/MR mode to interact.</p>
    </div>

    <a-scene
        webxr="
            optionalFeatures: dom-overlay, local-floor,bounded-floor,hand-tracking;
            overlayElement: #overlay;
        "
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        background="transparent: true"
        xr-mode-ui="enabled: true;"
     >
        <a-assets>
             <!-- CORRECTED PATH (Check your repo for exact Case!) -->
            <a-asset-item id="myModel" src="models/7dbc94cbc268404e7c6e90e9e063dc73.glb" crossorigin="anonymous"></a-asset-item>

            <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="anonymous">
        </a-assets>

       <!-- Camera Rig - This entity moves when you teleport or physically walk -->
       <a-entity id="rig" position="0 0 0">
            <a-entity
                id="camera"
                camera
                position="0 1.6 0"
                look-controls="pointerLockEnabled: false; magicWindowTrackingEnabled: false;"
            ></a-entity>
        </a-entity>

        <!-- Model Container: Stays at its world position. Interacted with. -->
        <a-entity
            id="modelContainer"
            position="0 1 -2"
            rotation="0 0 0"
            gesture-handler="minScale: 0.1; maxScale: 10;"
         >
             <!-- The actual 3D model -->
            <a-entity
                gltf-model="#myModel"
                id="theModel"
               scale="0.5 0.5 0.5"
               rotation="0 0 0"
                shadow="receive: false; cast: true"
            ></a-entity>
        </a-entity>

       <!-- Controllers -->
        <a-entity id="leftHand"
            oculus-touch-controls="hand: left"
            hand-tracking-controls="hand: left;"
            laser-controls="hand: left"
            raycaster="objects: #modelContainer; far: 5;" <!-- IMPORTANT: Point raycaster at the container that has gesture-handler -->
            > </a-entity>

       <a-entity id="rightHand"
            oculus-touch-controls="hand: right"
             hand-tracking-controls="hand: right;"
            laser-controls="hand: right"
            raycaster="objects: #ground, .teleportable; far: 10;"
            teleport-controls="
                cameraRig: #rig;
                teleportOrigin: #camera;
                collisionEntities: #ground;
                type: parabolic;
                button: trigger;
                 hitCylinderColor: #5290E6;
                hitCylinderRadius: 0.3;
                hitCylinderHeight: 0.1;
            ">
        </a-entity>

        <!-- Lighting -->
        <a-entity light="type: ambient; color: #BBB; intensity: 0.5"></a-entity>
        <a-entity
            light="
                type: directional;
                color: #FFF;
                intensity: 0.8;
                castShadow: true;
                shadowMapHeight: 2048;
                shadowMapWidth: 2048;
                shadowCameraLeft: -5;
                shadowCameraRight: 5;
                shadowCameraTop: 5;
                shadowCameraBottom: -5;
                 shadowCameraFar: 50;
                 shadowBias: -0.001;
             "
            position="-1 2 1.5"
        ></a-entity>

        <a-plane
            id="ground"
           class="teleportable"
            position="0 -0.01 0"
            rotation="-90 0 0"
            width="50"
            height="50"
            material="shader: flat; src: #groundTexture; repeat: 50 50; color: #555; transparent: true; opacity: 0.2;"
            shadow="receive: true"
            visible="true"
          ></a-plane>

        <a-sky color="#ECECEC" material="transparent: true; opacity: 0;"></a-sky>

    </a-scene>

     <script>
        // Ensure DOM is loaded before attaching listeners if needed, but A-Frame handles its own components.

        document.querySelector('a-scene').addEventListener('enter-vr', function () {
            document.getElementById('overlay').style.display = 'block';
         });

        document.querySelector('a-scene').addEventListener('exit-vr', function () {
             document.getElementById('overlay').style.display = 'none';
        });

    </script>
</body>
</html>
